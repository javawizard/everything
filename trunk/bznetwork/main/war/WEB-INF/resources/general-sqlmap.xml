<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>

	<!-- !ADDTOSQL -->

    <update id="executeSql" 
         parameterClass="java.lang.String" >
        $value$
    </update>

    <update id="setNextId" 
         parameterClass="java.lang.Integer" >
        update idsequence set nextvalue = #value#
    </update>

    <select id="getNextId" 
         resultClass="java.lang.Integer" >
        select * from idsequence
    </select>

    <update id="updateConfiguration" 
         parameterClass="jw.bznetwork.client.data.model.Configuration" >
        update configuration set
        welcome = #welcome#,
        sitename = #sitename#,
        contact = #contact#,
        executable = #executable#,
        menuleft = #menuleft#,
        currentname = #currentname#
    </update>

    <insert id="addAuthgroup" 
         parameterClass="jw.bznetwork.client.data.model.Authgroup" >
        insert into authgroups values 
        (#name#,#role#)
    </insert>

    <delete id="deleteAuthgroup" 
         parameterClass="java.lang.String" >
        delete from authgroups
        where name = #value#
    </delete>

    <delete id="deletePermissionsByTarget" 
         parameterClass="java.lang.Integer" >
        delete from permissions
        where target = #target#
    </delete>

    <delete id="deletePermissionsByRole" 
         parameterClass="java.lang.Integer" >
        delete from permissions
        where roleid = #value#
    </delete>

    <update id="deletePermission" 
         parameterClass="jw.bznetwork.client.data.model.Permission" >
        delete from permissions
        where roleid = #roleid#
        and permission = #permission#
        and target = #target#
    </update>

    <insert id="addPermission" 
         parameterClass="jw.bznetwork.client.data.model.Permission" >
        insert into permissions values
        (#roleid#, #permission#, #target#)
    </insert>

    <delete id="deleteRole" 
         parameterClass="jw.bznetwork.client.data.model.ValueFive" >
         delete from users where role = #data1#;
        delete from authgroups where role = #data2#;
		delete from callsigns where role = #data3#;
		delete from permissions where roleid = #data4#; 
        delete from roles where roleid = #data5#
    </delete>

    <update id="updateRole" 
         parameterClass="jw.bznetwork.client.data.model.Role" >
        update roles set name = #name#
        where roleid = #roleid#
    </update>

    <insert id="addRole" 
         parameterClass="jw.bznetwork.client.data.model.Role" >
        insert into roles values (#roleid#, #name#)
    </insert>

    <select id="listRoles" 
         resultClass="jw.bznetwork.client.data.model.Role" >
        select * from roles
    </select>

    <select id="getAuthgroupByName" 
         parameterClass="java.lang.String" 
         resultClass="jw.bznetwork.client.data.model.Authgroup" >
        select * from authgroups where name = #value#
    </select>

    <select id="listAuthgroups" 
         resultClass="jw.bznetwork.client.data.model.Authgroup" >
        select * from authgroups
    </select>

    <select id="getPermissionsByRole" 
         parameterClass="java.lang.Integer" 
         resultClass="jw.bznetwork.client.data.model.Permission" >
        select p.roleid, p.permission, p.target, s.groupid
        from permissions p left outer join servers s on s.serverid = p.target
        where p.roleid = #value#
    </select>

    <select id="getRoleById" 
         parameterClass="java.lang.Integer" 
         resultClass="jw.bznetwork.client.data.model.Role" >
        select * from roles where roleid = #value#
    </select>

    <select id="getUserByUsername" 
         parameterClass="java.lang.String" 
         resultClass="jw.bznetwork.client.data.model.User" >
        select * from users where username = #value#
    </select>

    <select id="getConfiguration" 
         resultClass="jw.bznetwork.client.data.model.Configuration" >
        select * from configuration
    </select>


</sqlMap>